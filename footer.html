<script>
  document.addEventListener("DOMContentLoaded", function () {
    var newNavbarHTML = `
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">CV Fernando Roa</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Select Language <span class="caret"></span></a>
                <ul class="dropdown-menu" id="language-menu">
                  <li><a href="#" onclick="setLanguage('en'); return false;">English</a></li>
                  <li><a href="#" onclick="setLanguage('pt'); return false;">Portuguese</a></li>
                  <li><a href="#" onclick="setLanguage('sp'); return false;">Spanish</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Select Category <span class="caret"></span></a>
                <ul class="dropdown-menu" id="category-menu">
                  <li><a href="#" onclick="setCategory('developer'); return false;">Developer</a></li>
                  <li><a href="#" onclick="setCategory('academic'); return false;">Academic</a></li>
                </ul>
              </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
          </div>
        </div>
      </div>
    `;

    var navbarFixedTop = document.querySelector(".navbar-fixed-top");
    if (navbarFixedTop) {
      navbarFixedTop.outerHTML = newNavbarHTML;
    }
    // Define the page mappings
    const pages = {
      en: {
        developer: "index.html",
        academic: "index_en_acad.html",
      },
      pt: {
        developer: "index_pt_dev.html",
        academic: "index_pt_acad.html",
      },
      sp: {
        developer: "index_sp_dev.html",
        academic: "index_sp_acad.html",
      },
    };

    // Function to handle language selection
    function setLanguage(language) {
      const currentCategory = getCategoryFromUrl(window.location.pathname);
      if (currentCategory) {
        const url = pages[language][currentCategory];
        window.location.href = url;
      }
    }

    // Function to handle category selection
    function setCategory(category) {
      const currentLanguage = getLanguageFromUrl(window.location.pathname);
      if (currentLanguage) {
        const url = pages[currentLanguage][category];
        window.location.href = url;
      }
    }

    // Get the current language from the URL
    function getLanguageFromUrl(url) {
      for (const language in pages) {
        for (const category in pages[language]) {
          if (url.endsWith(pages[language][category])) {
            return language;
          }
        }
      }
      return "en"; // Default to English if not found
    }

    // Get the current category from the URL
    function getCategoryFromUrl(url) {
      for (const language in pages) {
        for (const category in pages[language]) {
          if (url.endsWith(pages[language][category])) {
            return category;
          }
        }
      }
      return "developer"; // Default to developer if not found
    }

    // Set dropdown toggle text
    function setDropdownToggleText() {
      const currentPage = window.location.pathname;

      const languageTitle = getLanguageTitle(currentPage);
      const categoryTitle = getCategoryTitle(currentPage);

      const languageDropdownToggle = document
        .querySelector("#language-menu")
        .parentElement.querySelector(".dropdown-toggle");
      const categoryDropdownToggle = document
        .querySelector("#category-menu")
        .parentElement.querySelector(".dropdown-toggle");

      if (languageDropdownToggle) {
        languageDropdownToggle.innerHTML = `${languageTitle} <span class="caret"></span>`;
      }

      if (categoryDropdownToggle) {
        categoryDropdownToggle.innerHTML = `${categoryTitle} <span class="caret"></span>`;
      }
    }

    // Get the language title based on the current page
    function getLanguageTitle(currentPage) {
      const pageEnding = currentPage.substring(currentPage.lastIndexOf("/") + 1);
      const languageTitleMap = {
        curriculumpu: "English",
        "index.html": "English",
        "index_pt_dev.html": "Portuguese",
        "index_sp_dev.html": "Spanish",
        "index_en_acad.html": "English",
        "index_pt_acad.html": "Portuguese",
        "index_sp_acad.html": "Spanish",
      };
      return languageTitleMap[pageEnding] || "Select Language";
    }

    // Get the category title based on the current page
    function getCategoryTitle(currentPage) {
      const pageEnding = currentPage.substring(currentPage.lastIndexOf("/") + 1);
      const categoryTitleMap = {
        curriculumpu: "English",
        "index.html": "Developer",
        "index_pt_dev.html": "Developer",
        "index_sp_dev.html": "Developer",
        "index_en_acad.html": "Academic",
        "index_pt_acad.html": "Academic",
        "index_sp_acad.html": "Academic",
      };
      return categoryTitleMap[pageEnding] || "Select Category";
    }

    setDropdownToggleText();

    // Attach click event listeners to the dropdown menu items
    document.querySelectorAll("#language-menu a").forEach((item) => {
      item.addEventListener("click", function (event) {
        event.preventDefault();
        setLanguage(event.target.getAttribute("onclick").split("'")[1]);
      });
    });

    document.querySelectorAll("#category-menu a").forEach((item) => {
      item.addEventListener("click", function (event) {
        event.preventDefault();
        setCategory(event.target.getAttribute("onclick").split("'")[1]);
      });
    });
  });
</script>
