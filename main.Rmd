---
title: "main"
---
``` {r, echo=F, message = FALSE, eval=TRUE}
require(yaml)
require(purrr)

chapter_filename <- "names/chapters.yml"
chapters_names <- yaml.load_file(chapter_filename)

field_names_file <- "names/fields.yml"
field_names <- yaml.load_file(field_names_file)
```

<script>
document.addEventListener("DOMContentLoaded", function() {
  var sections = document.querySelectorAll("h1, h2, h3, h4, h5, h6");
  var sectionMap = {};

  sections.forEach(function(section) {
    var anchor = section.querySelector("a[id]");
    if (anchor) {
      var id = anchor.getAttribute("id");
      var number = section.querySelector("span.header-section-number");
      if (number) {
        sectionMap[id] = number.innerText.trim();
      }
    }
  });

  var refs = document.querySelectorAll(".ref-sec");
  refs.forEach(function(ref) {
    var target = ref.getAttribute("data-target");
    if (sectionMap[target]) {
      var link = document.createElement("a");
      link.href = "#" + target;
      link.innerText = sectionMap[target];
      link.addEventListener("click", function(event) {
        event.preventDefault();
        var targetElement = document.getElementById(target);
        window.scrollTo({
          top: targetElement.offsetTop - 60,
          behavior: "smooth"
        });
        history.pushState(null, null, "#" + target);
      });
      ref.innerHTML = "";
      ref.appendChild(link);
    }
  });
});
</script>

<!-- FUNCTIONS -->

``` {r, echo = FALSE, message = FALSE}
R_path <- normalizePath(file.path(getwd(), "R"))
source(file.path(R_path, "list_to_rmarkdown.R"))
source(file.path(R_path, "process_yaml.R"))
source(file.path(R_path, "bib.R"))
```

<!-- CHUNK CONFIG -->

```{r, include=FALSE}
knitr::opts_chunk$set(comment = NA)
knitr::opts_chunk$set(dev = c("png")) # important distorted zero in last figure
```

``` {r, echo=F, results="asis", eval = T}
yaml_content <- "config/contents.yml"

chapters <- yaml::read_yaml(yaml_content)

process_all_chapters(chapters)
```
