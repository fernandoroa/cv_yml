<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // Mapping of page endings to titles
    var pageTitleMap = {
      "index.html": "English - developer",
      "index_pt_dev.html": "Portuguese - desenvolvedor",
      "index_sp_dev.html": "Spanish - desarrollador",
      "index_en_acad.html": "English - academic",
      "index_pt_acad.html": "Portuguese - academic",
      "index_sp_acad.html": "Spanish - academic",
    };

    var defaultTitle = "Select profile";

    function getPageTitle(currentPage) {
      var pageEnding = currentPage.substring(currentPage.lastIndexOf("/") + 1);

      return pageTitleMap[pageEnding] || defaultTitle;
    }

    function setDropdownToggleText() {
      var currentPage = window.location.pathname;
      var pageTitle = getPageTitle(currentPage);

      var dropdownToggle = document.querySelector(".dropdown-toggle");
      if (dropdownToggle) {
        var caretSpan = document.createElement("span");
        caretSpan.classList.add("caret");
        dropdownToggle.innerText = pageTitle;
        dropdownToggle.appendChild(caretSpan);
      }
    }

    setDropdownToggleText();

    var sections = document.querySelectorAll("h1, h2, h3, h4, h5, h6");
    var sectionMap = {};

    sections.forEach(function (section) {
      var anchor = section.querySelector("a[id]");
      if (anchor) {
        var id = anchor.getAttribute("id");
        var number = section.querySelector("span.header-section-number");
        if (number) {
          sectionMap[id] = number.innerText.trim();
        }
      }
    });

    var refs = document.querySelectorAll(".ref-sec");
    refs.forEach(function (ref) {
      var target = ref.getAttribute("data-target");
      if (sectionMap[target]) {
        var link = document.createElement("a");
        link.href = "#" + target;
        link.innerText = sectionMap[target];
        link.addEventListener("click", function (event) {
          event.preventDefault();
          var targetElement = document.getElementById(target);
          window.scrollTo({
            top: targetElement.offsetTop - 60,
            behavior: "smooth",
          });
          history.pushState(null, null, "#" + target);
        });
        ref.innerHTML = "";
        ref.appendChild(link);
      }
    });
  });
</script>
